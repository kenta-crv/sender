# 自動送信システム設計書

## 概要
企業のお問い合わせフォームに自動で入力・送信するシステム

## 送信者情報（固定）
| 項目 | 値 |
|------|-----|
| 名前 | 山口 俊二 |
| 電話番号 | 050-7119-1716 |
| 住所 | 東京都中央区銀座6-13-16 |
| メール | mail@ebisu-hotel.tokyo |
| 会社名 | （未定） |

## 処理フロー

```
1. DBからcustomer（送信先企業）を取得
      ↓
2. contact_url にSeleniumでアクセス
      ↓
3. フォームの入力欄を自動検出
      ↓
4. 送信者情報を自動入力
      ↓
5. 送信ボタンをクリック
      ↓
6. 送信成功/失敗を判定
      ↓
7. 結果をCallモデルに記録
      ↓
8. 次のcustomerへ → 繰り返し
```

## フォーム入力欄の自動検出ロジック

### 検出対象フィールド
| フィールド | 検出キーワード（name/id/placeholder/label） |
|-----------|---------------------------------------------|
| 名前 | name, 名前, お名前, 氏名, your-name, fullname |
| メール | email, mail, メール, e-mail |
| 電話 | tel, phone, 電話, 携帯 |
| 会社名 | company, 会社, 御社名, 貴社名, organization |
| 住所 | address, 住所 |
| 本文 | message, body, 内容, お問い合わせ, inquiry, comment, textarea |

### 検出方法
1. `input`, `textarea`, `select` 要素を取得
2. `name`, `id`, `placeholder` 属性をチェック
3. 関連する `label` 要素のテキストをチェック
4. キーワードにマッチしたフィールドに適切な値を入力

## 送信ボタン検出ロジック

### 検出キーワード
- type="submit"
- 送信, 確認, 入力内容を確認, submit, send, confirm

## 送信成功判定ロジック

### 成功と判定する条件（いずれか）
1. URLが変更された（サンクスページへリダイレクト）
2. 「ありがとう」「送信完了」「受付」などのテキストが表示
3. フォームが非表示になった

### 失敗と判定する条件
1. エラーメッセージが表示
2. 必須項目の警告が表示
3. タイムアウト（30秒）

## Callモデルへの記録

| status | 意味 |
|--------|------|
| 送信成功 | フォーム送信が成功した |
| 送信失敗 | フォーム送信が失敗した |
| フォーム未検出 | お問い合わせフォームが見つからなかった |
| アクセス失敗 | URLにアクセスできなかった |

## 技術スタック

- **Selenium WebDriver** - ブラウザ自動操作
- **Chrome/Chromium** - ヘッドレスブラウザ
- **Sidekiq** - バックグラウンドジョブ（フェーズ3）
